<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DigitMatchStars Pro‚Ñ¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #0a0f1f; color: white; font-family: sans-serif; }
        .btn { padding: 15px 30px; border-radius: 10px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-green { background: #10b981; }
        .btn-purple { background: #8b5cf6; }
        .glass { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; }
    </style>

    <script>
        const CONFIG = {
            APP_ID: 117144,
            AFFILIATE_LINK: "https://track.deriv.com/_0rfpRaHuZeFMjdsyM5hasGNd7ZgqdRLk/1/",
            BOT_PAGE: "bot-obfuscated.html"
        };

        // üõ°Ô∏è EMERGENCY DEBUGGER & REDIRECTOR
        (function() {
            console.log("Checking for Deriv Token...");
            const currentHash = window.location.hash;
            
            if (currentHash && currentHash.includes('access_token=')) {
                console.log("Token detected in URL!");
                const params = new URLSearchParams(currentHash.substring(1));
                const token = params.get('access_token');
                
                if (token) {
                    localStorage.setItem('derivToken', token);
                    console.log("Token saved to Storage. Redirecting now...");
                    // Using replace ensures the user can't click "back" into a loop
                    window.location.replace(CONFIG.BOT_PAGE + "?token=" + token);
                }
            } else {
                console.log("No token found in URL. Staying on landing page.");
            }
        })();

        function startOAuth() {
            const redirectUri = window.location.origin + window.location.pathname;
            console.log("Starting OAuth with Redirect URI:", redirectUri);
            const authUrl = `https://oauth.deriv.com/oauth2/authorize?app_id=${CONFIG.APP_ID}&response_type=token&redirect_uri=${encodeURIComponent(redirectUri)}`;
            window.location.href = authUrl;
        }

        function openAffiliate() {
            window.open(CONFIG.AFFILIATE_LINK, '_blank');
            document.getElementById('choice-ui').style.display = 'none';
            document.getElementById('confirm-ui').style.display = 'block';
        }
    </script>
</head>
<body class="flex items-center justify-center min-height-screen py-20">

    <div class="glass max-w-md w-full text-center">
        <div id="choice-ui">
            <h1 class="text-3xl font-bold mb-2 text-green-400">DigitMatchStars Pro</h1>
            <p class="text-gray-400 mb-8">Select your account status to continue</p>
            
            <div class="flex flex-col gap-4">
                <button onclick="openAffiliate()" class="btn btn-green">
                    NEW USER (Create Account)
                </button>
                <button onclick="startOAuth()" class="btn btn-purple">
                    EXISTING USER (Login)
                </button>
            </div>
        </div>

        <div id="confirm-ui" style="display:none;">
            <h2 class="text-2xl font-bold mb-4">Account Created?</h2>
            <p class="text-gray-400 mb-6">If you finished your registration on Deriv, click below to connect the bot.</p>
            <button onclick="startOAuth()" class="btn btn-purple w-full">CONNECT BOT</button>
        </div>
    </div>

</body>
</html>
